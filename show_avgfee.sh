#!/bin/bash
echo -e "SCID\t\t\tAlias\t\t\t\tAvg Fee (ppm)\tForwards" && echo -e "$(printf '%.0s-' {1..80})" && cat ~/autofee/avg_fees.json | jq -r 'to_entries[] | "\(.key) \(.value)"' | while read scid fee; do alias=$(lncli getchaninfo "$scid" 2>/dev/null | jq -r --arg pubkey "$(lncli getinfo | jq -r .identity_pubkey)" 'if .node1_pub == $pubkey then .node2_pub else .node1_pub end' 2>/dev/null | xargs -I {} lncli getnodeinfo {} 2>/dev/null | jq -r '.node.alias // "Unknown"' 2>/dev/null | sed 's/[^a-zA-Z0-9._-]//g') || continue; forwards=$(sqlite3 ~/autofee/fee_history.db "SELECT count(*) FROM fee_history WHERE chan_id='$scid';" 2>/dev/null || echo "0"); [ -n "$alias" ] && printf "%-15s\t%-25s\t%s\t\t%s\n" "$scid" "${alias:0:25}" "$fee" "$forwards"; done